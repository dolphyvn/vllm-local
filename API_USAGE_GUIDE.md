# Knowledge Feeding API Usage Guide

This guide shows how to programmatically feed data to your AI model via REST API endpoints.

## üîê Authentication

All API endpoints require authentication. Include your session token in the Authorization header:

```bash
# First login to get session token
curl -X POST http://ai.vn.aliases.me/auth/login \
  -H "Content-Type: application/json" \
  -d '{"password": "admin123"}'

# Use the token in subsequent requests
curl -X POST http://ai.vn.aliases.me/api/knowledge/add \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_SESSION_TOKEN" \
  -d '{...}'
```

## üìö API Endpoints

### 1. Add Single Knowledge Entry

**Endpoint:** `POST /api/knowledge/add`

```bash
curl -X POST http://ai.vn.aliases.me/api/knowledge/add \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_SESSION_TOKEN" \
  -d '{
    "topic": "Technical Analysis",
    "content": "Technical analysis is a method of evaluating securities by analyzing statistics generated by market activity, such as past prices and volume.",
    "category": "trading",
    "confidence": 0.9,
    "tags": ["technical", "analysis", "trading"],
    "source": "Investopedia",
    "priority": 8
  }'
```

### 2. Bulk Knowledge Upload

**Endpoint:** `POST /api/knowledge/bulk`

```bash
curl -X POST http://ai.vn.aliases.me/api/knowledge/bulk \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_SESSION_TOKEN" \
  -d '{
    "knowledge_entries": [
      {
        "topic": "Support Level",
        "content": "Support level is a price level where a downtrend is expected to pause due to a concentration of demand.",
        "category": "trading",
        "confidence": 0.8,
        "tags": ["support", "technical", "price"],
        "priority": 9
      },
      {
        "topic": "Resistance Level",
        "content": "Resistance level is a price level where an uptrend is expected to pause due to a concentration of supply.",
        "category": "trading",
        "confidence": 0.8,
        "tags": ["resistance", "technical", "price"],
        "priority": 9
      }
    ],
    "batch_id": "technical_analysis_batch_1",
    "overwrite": false
  }'
```

### 3. Add Structured Lesson

**Endpoint:** `POST /api/lessons/add`

```bash
curl -X POST http://ai.vn.aliases.me/api/lessons/add \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_SESSION_TOKEN" \
  -d '{
    "title": "Risk Management Lesson",
    "situation": "Took a large position on a single trade without proper risk management",
    "lesson": "Never risk more than 2% of your trading capital on a single trade",
    "correct_approach": "Calculate position size based on 2% risk rule and use stop-loss",
    "wrong_approach": "Entered large position without considering risk percentage",
    "category": "risk_management",
    "confidence": 0.95,
    "tags": ["risk", "position sizing", "capital management"]
  }'
```

### 4. Add Correction

**Endpoint:** `POST /api/corrections/add`

```bash
curl -X POST http://ai.vn.aliases.me/api/corrections/add \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_SESSION_TOKEN" \
  -d '{
    "incorrect_statement": "TPO stands for Thyroid-stimulating hormone",
    "correct_statement": "TPO stands for Time Price Opportunity",
    "topic": "TPO",
    "explanation": "In trading contexts, TPO refers to Time Price Opportunity, a concept that considers both the timing and price action of trading opportunities.",
    "confidence": 1.0,
    "category": "corrections"
  }'
```

### 5. Add Definition

**Endpoint:** `POST /api/definitions/add`

```bash
curl -X POST http://ai.vn.aliases.me/api/definitions/add \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_SESSION_TOKEN" \
  -d '{
    "term": "RSI",
    "definition": "Relative Strength Index is a momentum oscillator that measures the speed and change of price movements.",
    "expanded_form": "Relative Strength Index",
    "context": "Technical analysis indicator",
    "examples": [
      "RSI above 70 indicates overbought conditions",
      "RSI below 30 indicates oversold conditions"
    ],
    "category": "definitions"
  }'
```

### 6. Get Knowledge Statistics

**Endpoint:** `GET /api/knowledge/stats`

```bash
curl -X GET http://ai.vn.aliases.me/api/knowledge/stats \
  -H "Authorization: Bearer YOUR_SESSION_TOKEN"
```

### 7. Clear All Knowledge

**Endpoint:** `DELETE /api/knowledge/clear`

‚ö†Ô∏è **Use with caution!** This will delete all stored knowledge.

```bash
curl -X DELETE http://ai.vn.aliases.me/api/knowledge/clear \
  -H "Authorization: Bearer YOUR_SESSION_TOKEN"
```

## üêç Python Example

```python
import requests
import json

class KnowledgeFeeder:
    def __init__(self, base_url="http://ai.vn.aliases.me"):
        self.base_url = base_url
        self.session_token = None
        self.login()

    def login(self, password="admin123"):
        """Login and get session token"""
        response = requests.post(f"{self.base_url}/auth/login",
                                json={"password": password})
        if response.status_code == 200:
            data = response.json()
            self.session_token = data.get("session_token")
            print("‚úÖ Login successful")
        else:
            raise Exception("Login failed")

    def get_headers(self):
        """Get headers with authentication"""
        return {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {self.session_token}"
        }

    def add_knowledge(self, topic, content, category="general", **kwargs):
        """Add a single knowledge entry"""
        data = {
            "topic": topic,
            "content": content,
            "category": category,
            **kwargs
        }
        response = requests.post(f"{self.base_url}/api/knowledge/add",
                                json=data,
                                headers=self.get_headers())
        return response.json()

    def add_correction(self, incorrect, correct, topic, **kwargs):
        """Add a correction entry"""
        data = {
            "incorrect_statement": incorrect,
            "correct_statement": correct,
            "topic": topic,
            **kwargs
        }
        response = requests.post(f"{self.base_url}/api/corrections/add",
                                json=data,
                                headers=self.get_headers())
        return response.json()

    def add_definition(self, term, definition, **kwargs):
        """Add a definition entry"""
        data = {
            "term": term,
            "definition": definition,
            **kwargs
        }
        response = requests.post(f"{self.base_url}/api/definitions/add",
                                json=data,
                                headers=self.get_headers())
        return response.json()

    def bulk_upload(self, entries):
        """Bulk upload multiple knowledge entries"""
        data = {"knowledge_entries": entries}
        response = requests.post(f"{self.base_url}/api/knowledge/bulk",
                                json=data,
                                headers=self.get_headers())
        return response.json()

    def get_stats(self):
        """Get knowledge statistics"""
        response = requests.get(f"{self.base_url}/api/knowledge/stats",
                              headers=self.get_headers())
        return response.json()

# Usage Example
if __name__ == "__main__":
    feeder = KnowledgeFeeder()

    # Add trading knowledge
    feeder.add_knowledge(
        topic="Stop Loss",
        content="A stop loss is an order placed to sell a security when it reaches a certain price point.",
        category="trading",
        confidence=0.9,
        tags=["risk", "order", "protection"]
    )

    # Add correction for TPO
    feeder.add_correction(
        incorrect="TPO stands for Thyroid-stimulating hormone",
        correct="TPO stands for Time Price Opportunity",
        topic="TPO",
        explanation="In trading, TPO refers to timing and price analysis of opportunities"
    )

    # Bulk upload multiple entries
    trading_terms = [
        {
            "topic": "Moving Average",
            "content": "A moving average is a calculation to analyze data points by creating series of averages of different subsets of the full data set.",
            "category": "trading",
            "confidence": 0.8,
            "tags": ["indicator", "trend"]
        },
        {
            "topic": "Volume",
            "content": "Volume is the number of shares or contracts traded in a security or an entire market during a given period.",
            "category": "trading",
            "confidence": 0.8,
            "tags": ["market", "liquidity"]
        }
    ]

    result = feeder.bulk_upload(trading_terms)
    print(f"Bulk upload result: {result}")

    # Check statistics
    stats = feeder.get_stats()
    print(f"Knowledge stats: {json.dumps(stats, indent=2)}")
```

## üìä Categories

Available categories:
- `general` - General knowledge
- `trading` - Trading and market information
- `financial` - Financial concepts
- `technical` - Technical analysis
- `business` - Business concepts
- `market` - Market dynamics
- `risk` - Risk management
- `strategy` - Trading strategies
- `definitions` - Term definitions
- `corrections` - Corrections and clarifications

## üîç Testing the RAG System

After adding knowledge via API, test it in the chat interface:

1. Go to `http://ai.vn.aliases.me/`
2. Ask questions about the topics you added
3. The model should now provide accurate answers based on your fed knowledge

Example:
- Add knowledge about "Stop Loss" via API
- Ask in chat: "What is a stop loss and how should I use it?"
- The model should provide the information you uploaded

## ‚ö†Ô∏è Best Practices

1. **Use High Confidence**: For factual information, use confidence ‚â• 0.9
2. **Add Source Information**: Always include where the knowledge comes from
3. **Use Appropriate Categories**: Choose the most relevant category
4. **Add Tags**: Include relevant tags for better retrieval
5. **Test After Upload**: Verify the model uses the knowledge correctly in chat

## üêõ Troubleshooting

- **401 Unauthorized**: Check your session token
- **400 Bad Request**: Verify JSON syntax and required fields
- **500 Internal Error**: Check server logs for detailed error information

The knowledge is stored in ChromaDB and will be retrieved by the RAG system during conversations to provide accurate, context-aware responses.